#include <stdio.h>   // Включва стандартната библиотека за вход/изход (printf, scanf, файлове)
#include <string.h>  // Включва библиотека за работа с низове (strstr)


// Дефинира константа за CO2 емисии при пътуване с кола (kg CO2 на километър)
#define CAR_CO2 0.21
// Дефинира константа за CO2 емисии при пътуване с автобус (kg CO2 на километър)
#define BUS_CO2 0.10
// Дефинира константа за CO2 емисии при използване на електричество (kg CO2 на kWh)
#define ELECTRICITY_CO2 0.42
// Дефинира константа за CO2 емисии при едно месно хранене (kg CO2)
#define MEAT_CO2 2.5

// Тази функция изчислява въглеродните емисии от транспорт.
// Тя приема изминатите километри и типа транспорт като аргументи.
float transport_emissions(int km, int type)
{


    // Проверява дали типът транспорт е кола
    if (type == 1)
        return km * CAR_CO2; // Връща CO2 емисиите за кола

    // Проверява дали типът транспорт е автобус
    else if (type == 2)
        return km * BUS_CO2; // Връща CO2 емисиите за автобус

    // Ако типът транспорт е невалиден
    else
        return 0;  // Връща 0, за да избегне грешни изчисления
}


// Функция, която изчислява CO2 емисиите от електричество
float electricity_emissions(float kwh)
{
    return kwh * ELECTRICITY_CO2; // Умножава използваните kWh по емисионния коефициент
}

// Функция, която изчислява CO2 емисиите от храна
float food_emissions(int meals)
{
    return meals * MEAT_CO2;   // Умножава броя хранения по емисионния коефициент
}

// Главна функция – тук започва изпълнението на програмата
int main(void)
{
    int km, transport_type, meat_meals; // Декларира променливи за километри, транспорт и хранения
    float kwh;  // Декларира променлива за електричество

    printf("Километри на ден: "); // Извежда съобщение за въвеждане на километри
    scanf("%d", &km);   // Чете въведеното число и го записва в km

    printf("Транспорт (1-кола, 2-автобус): "); // Пита за тип транспорт
    scanf("%d", &transport_type);   // Записва избрания тип транспорт

    printf("kWh ток на месец: "); // Пита за използваното електричество
    scanf("%f", &kwh);  // Записва стойността в kwh

    printf("Месни хранения на седмица: ");  // Пита за броя месни хранения
    scanf("%d", &meat_meals);  // Записва стойността в meat_meals

    float transport = transport_emissions(km, transport_type); // Изчислява CO2 емисиите от транспорт чрез функция
    float electricity = electricity_emissions(kwh); // Изчислява CO2 емисиите от електричество
    float food = food_emissions(meat_meals); // Изчислява CO2 емисиите от храна
    float total = transport + electricity + food; // Сумира всички емисии, за да получи общия въглероден отпечатък

    FILE *in = fopen("template.html", "r"); // Отваря HTML шаблона за четене
    FILE *out = fopen("result.html", "w"); // Създава нов HTML файл за записване на резултатите

    if (in == NULL || out == NULL)  // Проверява дали някой от файловете не е отворен успешно
    {
        printf("Грешка при отваряне на файл.\n"); // Извежда съобщение за грешка
        return 1; // Прекратява програмата с код за грешка
    }

    char line[256]; // Масив, в който ще се съхранява всеки ред от HTML файла

    while (fgets(line, sizeof(line), in))  // Чете HTML файла ред по ред, докато не стигне края
    {
        if (strstr(line, "<!-- TRANSPORT -->")) // Проверява дали редът съдържа маркера за транспорт
            fprintf(out, "<td>%.2f</td>\n", transport); // Записва стойността за електричество

        else if (strstr(line, "<!-- ELECTRICITY -->")) // Проверява дали редът съдържа маркера за електричество
            fprintf(out, "<td>%.2f</td>\n", electricity); // Записва стойността за електричество

        else if (strstr(line, "<!-- FOOD -->")) // Проверява дали редът съдържа маркера за храна
            fprintf(out, "<td>%.2f</td>\n", food); // Записва стойността за храна

        else if (strstr(line, "<!-- TOTAL -->")) // Проверява дали редът съдържа маркера за общата стойност
            fprintf(out, "<th>%.2f</th>\n", total); // Записва общата стойност

        else // Ако редът не съдържа маркер
            fputs(line, out); // Копира реда без промяна в резултатния файл
    }

    fclose(in); // Затваря входния HTML файл
    fclose(out); // Затваря изходния HTML файл

    printf("Готов HTML файл: result.html\n"); // Уведомява, че HTML файлът е създаден

    return 0;
}// Приключва програмата успешно
